<!-- main/templates/main/chatbot.html -->

{% extends 'main/base.html' %}
{% load static i18n %}

{% block title %}Chatbot{% endblock %}

{% block content %}
<div id="main-content">
    <h1>Welcome to the Chatbot Page</h1>
    <button onclick="openChat()">Open Chatbot</button>
</div>

<div id="chatbotSidebar" class="sidebar">
    <a href="javascript:void(0)" class="closebtn" onclick="closeChat()">&times;</a>
    <form id="chat-form">
        <input type="text" id="message" placeholder="Ask me anything..." required>
        <button type="submit" id="send-btn">Send</button>
    </form>
    <div id="chat-response" style="height: 400px; overflow-y: scroll;"></div>
</div>

<script>
    function openChat() {
        document.getElementById("chatbotSidebar").style.width = "300px";
    }

    function closeChat() {
        document.getElementById("chatbotSidebar").style.width = "0";
    }

    document.getElementById('chat-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const message = document.getElementById('message').value;
        fetch("{% url 'chatbot' %}", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": document.querySelector('[name=csrfmiddlewaretoken]').value
            },
            body: JSON.stringify({ message: message })
        })
        .then(response => response.json())
        .then(data => {
            const chatResponse = document.getElementById('chat-response');
            chatResponse.innerText = data.response;
            chatResponse.style.display = 'block';
            document.getElementById('message').value = '';
        });
    });
</script>
{% endblock %}
